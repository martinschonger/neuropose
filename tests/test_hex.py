from math import sqrt
import numpy as np
import unittest

from pose.hex import (
    # get_grid,
    unwrap_single,
    unwrap_multi,
    get_2d_distances,
    get_3d_distances,
    get_3d_coordinates,
    get_3d_coordinates_unwrapped
)


class TestHex(unittest.TestCase):
    def test_get_3d_coordinates_444(self):
        np.testing.assert_array_almost_equal(np.array(get_3d_coordinates((4, 4, 4))), np.array([[[[0., 0., 0., 0.],
                                                                                                [0.125, 0.125,
                                                                                                 0.125, 0.125],
                                                                                                [0., 0., 0., 0.],
                                                                                                [0.125, 0.125, 0.125, 0.125]],

                                                                                               [[0.25, 0.25, 0.25, 0.25],
                                                                                                [0.375, 0.375,
                                                                                                 0.375, 0.375],
                                                                                                [0.25, 0.25,
                                                                                                 0.25, 0.25],
                                                                                                [0.375, 0.375, 0.375, 0.375]],

                                                                                               [[0.5, 0.5, 0.5, 0.5],
                                                                                                [0.625, 0.625,
                                                                                                 0.625, 0.625],
                                                                                                [0.5, 0.5,
                                                                                                 0.5, 0.5],
                                                                                                [0.625, 0.625, 0.625, 0.625]],

                                                                                               [[0.75, 0.75, 0.75, 0.75],
                                                                                                [0.875, 0.875,
                                                                                                 0.875, 0.875],
                                                                                                [0.75, 0.75,
                                                                                                 0.75, 0.75],
                                                                                                [0.875, 0.875, 0.875, 0.875]]],


                                                                                              [[[0., 0., 0., 0.],
                                                                                                [0.21650635, 0.21650635,
                                                                                                 0.21650635, 0.21650635],
                                                                                                [0.4330127, 0.4330127,
                                                                                                 0.4330127, 0.4330127],
                                                                                                [0.64951905, 0.64951905, 0.64951905, 0.64951905]],

                                                                                               [[0., 0., 0., 0.],
                                                                                                [0.21650635, 0.21650635,
                                                                                                 0.21650635, 0.21650635],
                                                                                                [0.4330127, 0.4330127,
                                                                                                 0.4330127, 0.4330127],
                                                                                                [0.64951905, 0.64951905, 0.64951905, 0.64951905]],

                                                                                               [[0., 0., 0., 0.],
                                                                                                [0.21650635, 0.21650635,
                                                                                                 0.21650635, 0.21650635],
                                                                                                [0.4330127, 0.4330127,
                                                                                                 0.4330127, 0.4330127],
                                                                                                [0.64951905, 0.64951905, 0.64951905, 0.64951905]],

                                                                                               [[0., 0., 0., 0.],
                                                                                                [0.21650635, 0.21650635,
                                                                                                 0.21650635, 0.21650635],
                                                                                                [0.4330127, 0.4330127,
                                                                                                 0.4330127, 0.4330127],
                                                                                                [0.64951905, 0.64951905, 0.64951905, 0.64951905]]],


                                                                                              [[[0., 0.25, 0.5, 0.75],
                                                                                                [0., 0.25,
                                                                                                 0.5, 0.75],
                                                                                                [0., 0.25,
                                                                                                 0.5, 0.75],
                                                                                                [0., 0.25, 0.5, 0.75]],

                                                                                               [[0., 0.25, 0.5, 0.75],
                                                                                                [0., 0.25,
                                                                                                 0.5, 0.75],
                                                                                                [0., 0.25,
                                                                                                 0.5, 0.75],
                                                                                                [0., 0.25, 0.5, 0.75]],

                                                                                               [[0., 0.25, 0.5, 0.75],
                                                                                                [0., 0.25,
                                                                                                 0.5, 0.75],
                                                                                                [0., 0.25,
                                                                                                 0.5, 0.75],
                                                                                                [0., 0.25, 0.5, 0.75]],

                                                                                               [[0., 0.25, 0.5, 0.75],
                                                                                                [0., 0.25,
                                                                                                 0.5, 0.75],
                                                                                                [0., 0.25,
                                                                                                 0.5, 0.75],
                                                                                                [0., 0.25, 0.5, 0.75]]]]), decimal=8)

    def test_get_3d_coordinates_555(self):
        np.testing.assert_array_almost_equal(np.array(get_3d_coordinates((5, 5, 5))), np.array([[[[0., 0., 0., 0., 0.],
                                                                                                [0.1, 0.1, 0.1,
                                                                                                 0.1, 0.1],
                                                                                                [0., 0., 0.,
                                                                                                 0., 0.],
                                                                                                [0.1, 0.1, 0.1,
                                                                                                 0.1, 0.1],
                                                                                                [0., 0., 0., 0., 0.]],

                                                                                               [[0.2, 0.2, 0.2, 0.2, 0.2],
                                                                                                [0.3, 0.3, 0.3,
                                                                                                 0.3, 0.3],
                                                                                                [0.2, 0.2, 0.2,
                                                                                                 0.2, 0.2],
                                                                                                [0.3, 0.3, 0.3,
                                                                                                 0.3, 0.3],
                                                                                                [0.2, 0.2, 0.2, 0.2, 0.2]],

                                                                                               [[0.4, 0.4, 0.4, 0.4, 0.4],
                                                                                                [0.5, 0.5, 0.5,
                                                                                                 0.5, 0.5],
                                                                                                [0.4, 0.4, 0.4,
                                                                                                 0.4, 0.4],
                                                                                                [0.5, 0.5, 0.5,
                                                                                                 0.5, 0.5],
                                                                                                [0.4, 0.4, 0.4, 0.4, 0.4]],

                                                                                               [[0.6, 0.6, 0.6, 0.6, 0.6],
                                                                                                [0.7, 0.7, 0.7,
                                                                                                 0.7, 0.7],
                                                                                                [0.6, 0.6, 0.6,
                                                                                                 0.6, 0.6],
                                                                                                [0.7, 0.7, 0.7,
                                                                                                 0.7, 0.7],
                                                                                                [0.6, 0.6, 0.6, 0.6, 0.6]],

                                                                                               [[0.8, 0.8, 0.8, 0.8, 0.8],
                                                                                                [0.9, 0.9, 0.9,
                                                                                                 0.9, 0.9],
                                                                                                [0.8, 0.8, 0.8,
                                                                                                 0.8, 0.8],
                                                                                                [0.9, 0.9, 0.9,
                                                                                                 0.9, 0.9],
                                                                                                [0.8, 0.8, 0.8, 0.8, 0.8]]],


                                                                                              [[[0., 0., 0., 0., 0.],
                                                                                                [0.17320508, 0.17320508, 0.17320508,
                                                                                                 0.17320508, 0.17320508],
                                                                                                [0.34641016, 0.34641016, 0.34641016,
                                                                                                 0.34641016, 0.34641016],
                                                                                                [0.51961524, 0.51961524, 0.51961524,
                                                                                                 0.51961524, 0.51961524],
                                                                                                [0.69282032, 0.69282032, 0.69282032, 0.69282032, 0.69282032]],

                                                                                               [[0., 0., 0., 0., 0.],
                                                                                                [0.17320508, 0.17320508, 0.17320508,
                                                                                                 0.17320508, 0.17320508],
                                                                                                [0.34641016, 0.34641016, 0.34641016,
                                                                                                 0.34641016, 0.34641016],
                                                                                                [0.51961524, 0.51961524, 0.51961524,
                                                                                                 0.51961524, 0.51961524],
                                                                                                [0.69282032, 0.69282032, 0.69282032, 0.69282032, 0.69282032]],

                                                                                               [[0., 0., 0., 0., 0.],
                                                                                                [0.17320508, 0.17320508, 0.17320508,
                                                                                                 0.17320508, 0.17320508],
                                                                                                [0.34641016, 0.34641016, 0.34641016,
                                                                                                 0.34641016, 0.34641016],
                                                                                                [0.51961524, 0.51961524, 0.51961524,
                                                                                                 0.51961524, 0.51961524],
                                                                                                [0.69282032, 0.69282032, 0.69282032, 0.69282032, 0.69282032]],

                                                                                               [[0., 0., 0., 0., 0.],
                                                                                                [0.17320508, 0.17320508, 0.17320508,
                                                                                                 0.17320508, 0.17320508],
                                                                                                [0.34641016, 0.34641016, 0.34641016,
                                                                                                 0.34641016, 0.34641016],
                                                                                                [0.51961524, 0.51961524, 0.51961524,
                                                                                                 0.51961524, 0.51961524],
                                                                                                [0.69282032, 0.69282032, 0.69282032, 0.69282032, 0.69282032]],

                                                                                               [[0., 0., 0., 0., 0.],
                                                                                                [0.17320508, 0.17320508, 0.17320508,
                                                                                                 0.17320508, 0.17320508],
                                                                                                [0.34641016, 0.34641016, 0.34641016,
                                                                                                 0.34641016, 0.34641016],
                                                                                                [0.51961524, 0.51961524, 0.51961524,
                                                                                                 0.51961524, 0.51961524],
                                                                                                [0.69282032, 0.69282032, 0.69282032, 0.69282032, 0.69282032]]],


                                                                                              [[[0., 0.2, 0.4, 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4, 0.6, 0.8]],

                                                                                               [[0., 0.2, 0.4, 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4, 0.6, 0.8]],

                                                                                               [[0., 0.2, 0.4, 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4, 0.6, 0.8]],

                                                                                               [[0., 0.2, 0.4, 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4, 0.6, 0.8]],

                                                                                               [[0., 0.2, 0.4, 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4,
                                                                                                 0.6, 0.8],
                                                                                                [0., 0.2, 0.4, 0.6, 0.8]]]]), decimal=8)

    def test_get_2d_distances_444(self):
        fourier_coef_shape = (4, 4, 4)
        u2_diff, v2_diff = get_2d_distances(fourier_coef_shape)
        u2_diff_resh = u2_diff.reshape(
            (fourier_coef_shape[0], fourier_coef_shape[1], fourier_coef_shape[0], fourier_coef_shape[1]))
        v2_diff_resh = v2_diff.reshape(
            (fourier_coef_shape[0], fourier_coef_shape[1], fourier_coef_shape[0], fourier_coef_shape[1]))

        np.testing.assert_array_equal(u2_diff_resh[0, 0], np.array([[0.,  0.125,  0., -0.375],
                                                                    [0.25,  0.375, -0.25, -0.125],
                                                                    [0.5, -0.375,  0.,  0.125],
                                                                    [-0.25, -0.125,  0.25,  0.375]]))

        np.testing.assert_array_equal(v2_diff_resh[0, 0], np.array([[0.,  0.21650635094610968,  0.43301270189221935,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096]]))

        np.testing.assert_array_equal(u2_diff_resh[0, 1], np.array([[-0.125,  0., -0.125,  0.],
                                                                    [0.125,  0.25,  0.125,  0.25],
                                                                    [0.375,  0.5,  0.375,  0.],
                                                                    [-0.375, -0.25, -0.375,  0.25]]))

        np.testing.assert_array_equal(v2_diff_resh[0, 1], np.array([[-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     -0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     -0.4330127018922193]]))

        np.testing.assert_array_equal(u2_diff_resh[0, 2], np.array([[0.,  0.125,  0.,  0.125],
                                                                    [-0.25,  0.375,  0.25,  0.375],
                                                                    [0., -0.375,  0.5, -0.375],
                                                                    [0.25, -0.125, -0.25, -0.125]]))

        np.testing.assert_array_equal(v2_diff_resh[0, 2], np.array([[-0.43301270189221935, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965]]))

        np.testing.assert_array_equal(u2_diff_resh[0, 3], np.array([[0.375,  0., -0.125,  0.],
                                                                    [-0.375,  0.25,  0.125,  0.25],
                                                                    [-0.125,  0.,  0.375,  0.5],
                                                                    [0.125,  0.25, -0.375, -0.25]]))

        np.testing.assert_array_equal(v2_diff_resh[0, 3], np.array([[0.2165063509461096, -0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096, -0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096,  0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096,  0.4330127018922193, -0.21650635094610965,
                                                                     0.]]))

        np.testing.assert_array_equal(u2_diff_resh[1, 0], np.array([[-0.25, -0.125,  0.25,  0.375],
                                                                    [0.,  0.125,  0., -0.375],
                                                                    [0.25,  0.375, -0.25, -0.125],
                                                                    [0.5, -0.375,  0.,  0.125]]))

        np.testing.assert_array_equal(v2_diff_resh[1, 0], np.array([[0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968,  0.43301270189221935,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096]]))

        np.testing.assert_array_equal(u2_diff_resh[1, 1], np.array([[-0.375, -0.25, -0.375, -0.25],
                                                                    [-0.125,  0., -0.125,  0.],
                                                                    [0.125,  0.25,  0.125,  0.25],
                                                                    [0.375,  0.5,  0.375,  0.]]))

        np.testing.assert_array_equal(v2_diff_resh[1, 1], np.array([[-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     -0.4330127018922193]]))

        np.testing.assert_array_equal(u2_diff_resh[1, 2], np.array([[0.25, -0.125, -0.25, -0.125],
                                                                    [0.,  0.125,  0.,  0.125],
                                                                    [-0.25,  0.375,  0.25,  0.375],
                                                                    [0., -0.375,  0.5, -0.375]]))

        np.testing.assert_array_equal(v2_diff_resh[1, 2], np.array([[0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [-0.43301270189221935, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965]]))

        np.testing.assert_array_equal(u2_diff_resh[1, 3], np.array([[0.125, -0.25, -0.375, -0.25],
                                                                    [0.375,  0., -0.125,  0.],
                                                                    [-0.375,  0.25,  0.125,  0.25],
                                                                    [-0.125,  0.,  0.375,  0.5]]))

        np.testing.assert_array_equal(v2_diff_resh[1, 3], np.array([[0.2165063509461096, -0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096, -0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096, -0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096,  0.4330127018922193, -0.21650635094610965,
                                                                     0.]]))

        np.testing.assert_array_equal(u2_diff_resh[2, 0], np.array([[-0.5, -0.375,  0.,  0.125],
                                                                    [-0.25, -0.125,  0.25,  0.375],
                                                                    [0.,  0.125,  0., -0.375],
                                                                    [0.25,  0.375, -0.25, -0.125]]))

        np.testing.assert_array_equal(v2_diff_resh[2, 0], np.array([[0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968,  0.43301270189221935,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096]]))

        np.testing.assert_array_equal(u2_diff_resh[2, 1], np.array([[0.375, -0.5,  0.375,  0.],
                                                                    [-0.375, -0.25, -0.375, -0.25],
                                                                    [-0.125,  0., -0.125,  0.],
                                                                    [0.125,  0.25,  0.125,  0.25]]))

        np.testing.assert_array_equal(v2_diff_resh[2, 1], np.array([[-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     -0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     0.4330127018922193]]))

        np.testing.assert_array_equal(u2_diff_resh[2, 2], np.array([[0., -0.375, -0.5, -0.375],
                                                                    [0.25, -0.125, -0.25, -0.125],
                                                                    [0.,  0.125,  0.,  0.125],
                                                                    [-0.25,  0.375,  0.25,  0.375]]))

        np.testing.assert_array_equal(v2_diff_resh[2, 2], np.array([[0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [-0.43301270189221935, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965]]))

        np.testing.assert_array_equal(u2_diff_resh[2, 3], np.array([[-0.125,  0.,  0.375, -0.5],
                                                                    [0.125, -0.25, -0.375, -0.25],
                                                                    [0.375,  0., -0.125,  0.],
                                                                    [-0.375,  0.25,  0.125,  0.25]]))

        np.testing.assert_array_equal(v2_diff_resh[2, 3], np.array([[0.2165063509461096,  0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096, -0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096, -0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096, -0.4330127018922193, -0.21650635094610965,
                                                                     0.]]))

        np.testing.assert_array_equal(u2_diff_resh[3, 0], np.array([[0.25,  0.375, -0.25, -0.125],
                                                                    [-0.5, -0.375,  0.,  0.125],
                                                                    [-0.25, -0.125,  0.25,  0.375],
                                                                    [0.,  0.125,  0., -0.375]]))

        np.testing.assert_array_equal(v2_diff_resh[3, 0], np.array([[0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968, -0.43301270189221924,
                                                                     -0.2165063509461096],
                                                                    [0.,  0.21650635094610968,  0.43301270189221935,
                                                                     -0.2165063509461096]]))

        np.testing.assert_array_equal(u2_diff_resh[3, 1], np.array([[0.125,  0.25,  0.125, -0.25],
                                                                    [0.375, -0.5,  0.375,  0.],
                                                                    [-0.375, -0.25, -0.375, -0.25],
                                                                    [-0.125,  0., -0.125,  0.]]))

        np.testing.assert_array_equal(v2_diff_resh[3, 1], np.array([[-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     -0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     -0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     0.4330127018922193],
                                                                    [-0.21650635094610968,  0.,  0.21650635094610968,
                                                                     0.4330127018922193]]))

        np.testing.assert_array_equal(u2_diff_resh[3, 2], np.array([[-0.25,  0.375,  0.25,  0.375],
                                                                    [0., -0.375, -0.5, -0.375],
                                                                    [0.25, -0.125, -0.25, -0.125],
                                                                    [0.,  0.125,  0.,  0.125]]))

        np.testing.assert_array_equal(v2_diff_resh[3, 2], np.array([[0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [0.43301270189221924, -0.21650635094610968,  0.,
                                                                     0.21650635094610965],
                                                                    [-0.43301270189221935, -0.21650635094610968,  0.,
                                                                     0.21650635094610965]]))

        np.testing.assert_array_equal(u2_diff_resh[3, 3], np.array([[-0.375, -0.25,  0.125,  0.25],
                                                                    [-0.125,  0.,  0.375, -0.5],
                                                                    [0.125, -0.25, -0.375, -0.25],
                                                                    [0.375,  0., -0.125,  0.]]))

        np.testing.assert_array_equal(v2_diff_resh[3, 3], np.array([[0.2165063509461096,  0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096,  0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096, -0.4330127018922193, -0.21650635094610965,
                                                                     0.],
                                                                    [0.2165063509461096, -0.4330127018922193, -0.21650635094610965,
                                                                     0.]]))

    def test_get_2d_distances_555(self):
        fourier_coef_shape = (5, 5, 5)
        u2_diff, v2_diff = get_2d_distances(fourier_coef_shape)
        u2_diff_resh = u2_diff.reshape(
            (fourier_coef_shape[0], fourier_coef_shape[1], fourier_coef_shape[0], fourier_coef_shape[1]))
        v2_diff_resh = v2_diff.reshape(
            (fourier_coef_shape[0], fourier_coef_shape[1], fourier_coef_shape[0], fourier_coef_shape[1]))

        np.testing.assert_array_almost_equal(u2_diff_resh[0, 0], np.array([[0.,  0.1,  0., -0.4, -0.5],
                                                                           [0.2,  0.3,  0.2, -0.2, -0.3],
                                                                           [0.4,  0.5, -0.1,  0., -0.1],
                                                                           [-0.4, -0.3,  0.1,  0.2,  0.1],
                                                                           [-0.2, -0.1, -0.2,  0.4,  0.3]]), decimal=16)

        np.testing.assert_array_almost_equal(v2_diff_resh[0, 0], np.array([[0.,  0.17320508075688773,  0.34641016151377546,
                                                                            -0.34641016151377535, -0.17320508075688767],
                                                                           [0.,  0.17320508075688773,  0.34641016151377546,
                                                                            -0.34641016151377535, -0.17320508075688767],
                                                                           [0.,  0.17320508075688773, -0.5196152422706631,
                                                                            -0.34641016151377535, -0.17320508075688767],
                                                                           [0.,  0.17320508075688773, -0.5196152422706631,
                                                                            -0.34641016151377535, -0.17320508075688767],
                                                                           [0.,  0.17320508075688773,  0.34641016151377546,
                                                                            -0.34641016151377535, -0.17320508075688767]]), decimal=16)

        np.testing.assert_array_almost_equal(u2_diff_resh[0, 2], np.array([[0.,  0.1,  0.,  0.1,  0.],
                                                                           [0.2,  0.3,  0.2,  0.3,  0.2],
                                                                           [-0.1,  0.5,  0.4,  0.5, -0.1],
                                                                           [0.1, -0.3, -0.4, -0.3,  0.1],
                                                                           [-0.2, -0.1, -0.2, -0.1, -0.2]]), decimal=16)

        np.testing.assert_array_almost_equal(v2_diff_resh[0, 2], np.array([[-0.34641016151377546, -0.17320508075688773,  0.,
                                                                            0.17320508075688779,  0.34641016151377546],
                                                                           [-0.34641016151377546, -0.17320508075688773,  0.,
                                                                            0.17320508075688779,  0.34641016151377546],
                                                                           [0.5196152422706631, -0.17320508075688773,  0.,
                                                                            0.17320508075688779, -0.5196152422706631],
                                                                           [0.5196152422706631, -0.17320508075688773,  0.,
                                                                            0.17320508075688779, -0.5196152422706631],
                                                                           [-0.34641016151377546, -0.17320508075688773,  0.,
                                                                            0.17320508075688779,  0.34641016151377546]]), decimal=16)

        np.testing.assert_array_almost_equal(u2_diff_resh[3, 1], np.array([[0.3,  0.4,  0.3, -0.1, -0.2],
                                                                           [-0.5, -0.4, -0.5,  0.1,  0.],
                                                                           [-0.3, -0.2, -0.3, -0.2,  0.2],
                                                                           [-0.1,  0., -0.1,  0.,  0.4],
                                                                           [0.1,  0.2,  0.1,  0.2, -0.4]]), decimal=16)

        np.testing.assert_array_almost_equal(v2_diff_resh[3, 1], np.array([[-0.17320508075688773,  0.,  0.17320508075688773,
                                                                           -0.519615242270663, -0.34641016151377535],
                                                                           [-0.17320508075688773,  0.,  0.17320508075688773,
                                                                           -0.519615242270663, -0.34641016151377535],
                                                                           [-0.17320508075688773,  0.,  0.17320508075688773,
                                                                            0.3464101615137755, -0.34641016151377535],
                                                                           [-0.17320508075688773,  0.,  0.17320508075688773,
                                                                            0.3464101615137755, -0.34641016151377535],
                                                                           [-0.17320508075688773,  0.,  0.17320508075688773,
                                                                            0.3464101615137755, -0.34641016151377535]]), decimal=16)

    def test_get_3d_distances(self):
        fourier_coef_shape = (4, 4, 4)
        u_diff, v_diff, w_diff = get_3d_distances(fourier_coef_shape)
        u_diff_unwrapped = unwrap_multi(u_diff.reshape(
            (*fourier_coef_shape, *fourier_coef_shape)), fourier_coef_shape, 1)
        v_diff_unwrapped = unwrap_multi(v_diff.reshape(
            (*fourier_coef_shape, *fourier_coef_shape)), fourier_coef_shape, 1)
        w_diff_unwrapped = unwrap_multi(w_diff.reshape(
            (*fourier_coef_shape, *fourier_coef_shape)), fourier_coef_shape, 1)

        np.testing.assert_array_equal(u_diff_unwrapped[0, 0, 0], np.array([[[0.,  0.,  0.,  0.],
                                                                            [0.125,  0.125,  0.125,  0.125],
                                                                            [-0.25, -0.25, -0.25, -0.25],
                                                                            [-0.125, -0.125, -0.125, -0.125]],

                                                                           [[0.25,  0.25,  0.25,  0.25],
                                                                            [0.375,  0.375,  0.375,  0.375],
                                                                            [0.,  0.,  0.,  0.],
                                                                            [0.125,  0.125,  0.125,  0.125]],

                                                                           [[0.5,  0.5,  0.5,  0.5],
                                                                            [-0.375, -0.375, -0.375, -0.375],
                                                                            [0.25,  0.25,  0.25,  0.25],
                                                                            [0.375,  0.375,  0.375,  0.375]],

                                                                           [[-0.25, -0.25, -0.25, -0.25],
                                                                            [-0.125, -0.125, -0.125, -0.125],
                                                                            [0.,  0.,  0.,  0.],
                                                                            [-0.375, -0.375, -0.375, -0.375]]]))

        np.testing.assert_array_equal(v_diff_unwrapped[0, 0, 0], np.array([[[0.,  0.,
                                                                             0.,  0.],
                                                                            [0.21650635094610968,  0.21650635094610968,
                                                                            0.21650635094610968,  0.21650635094610968],
                                                                            [-0.43301270189221924, -0.43301270189221924,
                                                                             -0.43301270189221924, -0.43301270189221924],
                                                                            [-0.2165063509461096, -0.2165063509461096,
                                                                             -0.2165063509461096, -0.2165063509461096]],

                                                                           [[0.,  0.,
                                                                             0.,  0.],
                                                                            [0.21650635094610968,  0.21650635094610968,
                                                                             0.21650635094610968,  0.21650635094610968],
                                                                            [-0.43301270189221924, -0.43301270189221924,
                                                                               -0.43301270189221924, -0.43301270189221924],
                                                                            [-0.2165063509461096, -0.2165063509461096,
                                                                               -0.2165063509461096, -0.2165063509461096]],

                                                                           [[0.,  0.,
                                                                             0.,  0.],
                                                                            [0.21650635094610968,  0.21650635094610968,
                                                                             0.21650635094610968,  0.21650635094610968],
                                                                            [-0.43301270189221924, -0.43301270189221924,
                                                                               -0.43301270189221924, -0.43301270189221924],
                                                                            [-0.2165063509461096, -0.2165063509461096,
                                                                               -0.2165063509461096, -0.2165063509461096]],

                                                                           [[0.,  0.,
                                                                             0.,  0.],
                                                                            [0.21650635094610968,  0.21650635094610968,
                                                                             0.21650635094610968,  0.21650635094610968],
                                                                            [0.43301270189221935,  0.43301270189221935,
                                                                               0.43301270189221935,  0.43301270189221935],
                                                                            [-0.2165063509461096, -0.2165063509461096,
                                                                               -0.2165063509461096, -0.2165063509461096]]]))

        np.testing.assert_array_equal(u_diff_unwrapped[1, 2, 0], np.array([[[0.,  0.,  0.,  0.],
                                                                            [-0.375, -0.375, -0.375, -0.375],
                                                                            [-0.25, -0.25, -0.25, -0.25],
                                                                            [-0.125, -0.125, -0.125, -0.125]],

                                                                           [[0.25,  0.25,  0.25,  0.25],
                                                                            [-0.125, -0.125, -0.125, -0.125],
                                                                            [0.,  0.,  0.,  0.],
                                                                            [0.125,  0.125,  0.125,  0.125]],

                                                                           [[0.,  0.,  0.,  0.],
                                                                            [0.125,  0.125,  0.125,  0.125],
                                                                            [0.25,  0.25,  0.25,  0.25],
                                                                            [0.375,  0.375,  0.375,  0.375]],

                                                                           [[-0.25, -0.25, -0.25, -0.25],
                                                                            [0.375,  0.375,  0.375,  0.375],
                                                                            [-0.5, -0.5, -0.5, -0.5],
                                                                            [-0.375, -0.375, -0.375, -0.375]]]))

        np.testing.assert_array_equal(v_diff_unwrapped[1, 2, 0], np.array([[[0.43301270189221924,  0.43301270189221924,
                                                                             0.43301270189221924,  0.43301270189221924],
                                                                            [-0.21650635094610968, -0.21650635094610968,
                                                                           -0.21650635094610968, -0.21650635094610968],
                                                                            [0.,  0.,
                                                                            0.,  0.],
                                                                            [0.21650635094610965,  0.21650635094610965,
                                                                            0.21650635094610965,  0.21650635094610965]],

                                                                           [[0.43301270189221924,  0.43301270189221924,
                                                                            0.43301270189221924,  0.43301270189221924],
                                                                            [-0.21650635094610968, -0.21650635094610968,
                                                                            -0.21650635094610968, -0.21650635094610968],
                                                                            [0.,  0.,
                                                                            0.,  0.],
                                                                            [0.21650635094610965,  0.21650635094610965,
                                                                            0.21650635094610965,  0.21650635094610965]],

                                                                           [[-0.43301270189221935, -0.43301270189221935,
                                                                            -0.43301270189221935, -0.43301270189221935],
                                                                            [-0.21650635094610968, -0.21650635094610968,
                                                                            -0.21650635094610968, -0.21650635094610968],
                                                                            [0.,  0.,
                                                                                0.,  0.],
                                                                            [0.21650635094610965,  0.21650635094610965,
                                                                                0.21650635094610965,  0.21650635094610965]],

                                                                           [[0.43301270189221924,  0.43301270189221924,
                                                                            0.43301270189221924,  0.43301270189221924],
                                                                            [-0.21650635094610968, -0.21650635094610968,
                                                                            -0.21650635094610968, -0.21650635094610968],
                                                                            [0.,  0.,
                                                                            0.,  0.],
                                                                            [0.21650635094610965,  0.21650635094610965,
                                                                            0.21650635094610965,  0.21650635094610965]]]))

        np.testing.assert_array_equal(u_diff_unwrapped[3, 1, 0], np.array([[[0.125,  0.125,  0.125,  0.125],
                                                                            [0.25,  0.25,  0.25,  0.25],
                                                                            [0.375,  0.375,  0.375,  0.375],
                                                                            [0.,  0.,  0.,  0.]],

                                                                           [[0.375,  0.375,  0.375,  0.375],
                                                                            [-0.5, -0.5, -0.5, -0.5],
                                                                            [-0.375, -0.375, -0.375, -0.375],
                                                                            [-0.25, -0.25, -0.25, -0.25]],

                                                                           [[-0.375, -0.375, -0.375, -0.375],
                                                                            [-0.25, -0.25, -0.25, -0.25],
                                                                            [-0.125, -0.125, -0.125, -0.125],
                                                                            [0.,  0.,  0.,  0.]],

                                                                           [[-0.125, -0.125, -0.125, -0.125],
                                                                            [0.,  0.,  0.,  0.],
                                                                            [0.125,  0.125,  0.125,  0.125],
                                                                            [-0.25, -0.25, -0.25, -0.25]]]))

        np.testing.assert_array_equal(v_diff_unwrapped[3, 1, 0], np.array([[[-0.21650635094610968, -0.21650635094610968,
                                                                           -0.21650635094610968, -0.21650635094610968],
                                                                            [0.,  0.,
                                                                            0.,  0.],
                                                                            [0.21650635094610968,  0.21650635094610968,
                                                                             0.21650635094610968,  0.21650635094610968],
                                                                            [-0.4330127018922193, -0.4330127018922193,
                                                                             -0.4330127018922193, -0.4330127018922193]],

                                                                           [[-0.21650635094610968, -0.21650635094610968,
                                                                             -0.21650635094610968, -0.21650635094610968],
                                                                            [0.,  0.,
                                                                               0.,  0.],
                                                                            [0.21650635094610968,  0.21650635094610968,
                                                                               0.21650635094610968,  0.21650635094610968],
                                                                            [0.4330127018922193,  0.4330127018922193,
                                                                               0.4330127018922193,  0.4330127018922193]],

                                                                           [[-0.21650635094610968, -0.21650635094610968,
                                                                             -0.21650635094610968, -0.21650635094610968],
                                                                            [0.,  0.,
                                                                               0.,  0.],
                                                                            [0.21650635094610968,  0.21650635094610968,
                                                                               0.21650635094610968,  0.21650635094610968],
                                                                            [0.4330127018922193,  0.4330127018922193,
                                                                               0.4330127018922193,  0.4330127018922193]],

                                                                           [[-0.21650635094610968, -0.21650635094610968,
                                                                             -0.21650635094610968, -0.21650635094610968],
                                                                            [0.,  0.,
                                                                               0.,  0.],
                                                                            [0.21650635094610968,  0.21650635094610968,
                                                                               0.21650635094610968,  0.21650635094610968],
                                                                            [-0.4330127018922193, -0.4330127018922193,
                                                                               -0.4330127018922193, -0.4330127018922193]]]))

        np.testing.assert_array_equal(w_diff_unwrapped[0, 0, 0], np.array([[[0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25]],

                                                                           [[0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25]],

                                                                           [[0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25]],

                                                                           [[0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25],
                                                                            [0.,  0.25,  0.5, -0.25]]]))

        np.testing.assert_array_equal(w_diff_unwrapped[0, 0, 1], np.array([[[-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5]],

                                                                           [[-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5]],

                                                                           [[-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5]],

                                                                           [[-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5],
                                                                            [-0.25,  0.,  0.25,  0.5]]]))

        np.testing.assert_array_equal(w_diff_unwrapped[0, 0, 2], np.array([[[-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25]],

                                                                           [[-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25]],

                                                                           [[-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25]],

                                                                           [[-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25],
                                                                            [-0.5, -0.25,  0.,  0.25]]]))

        np.testing.assert_array_equal(w_diff_unwrapped[0, 0, 3], np.array([[[0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.]],

                                                                           [[0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.]],

                                                                           [[0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.]],

                                                                           [[0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.],
                                                                            [0.25, -0.5, -0.25,  0.]]]))

        for u in range(fourier_coef_shape[0]):
            for v in range(fourier_coef_shape[1]):
                for w1 in range(fourier_coef_shape[2]):
                    for w2 in range(fourier_coef_shape[2]):
                        np.testing.assert_array_equal(u_diff_unwrapped[u, v, w1], u_diff_unwrapped[u, v, w2])
                        np.testing.assert_array_equal(v_diff_unwrapped[u, v, w1], v_diff_unwrapped[u, v, w2])

        for w in range(fourier_coef_shape[2]):
            for u1 in range(fourier_coef_shape[0]):
                for u2 in range(fourier_coef_shape[0]):
                    for v1 in range(fourier_coef_shape[1]):
                        for v2 in range(fourier_coef_shape[1]):
                            np.testing.assert_array_equal(w_diff_unwrapped[u1, v1, w], w_diff_unwrapped[u2, v2, w])

    def test_unwrap_single(self):
        np.testing.assert_array_almost_equal(unwrap_single(np.stack(get_3d_coordinates(
            (4, 4, 4)), axis=-1), (4, 4, 4), 3), get_3d_coordinates_unwrapped((4, 4, 4), np.array([[1, 0.5, 0], [0, sqrt(3)/2, 0], [0, 0, 1]])/4), decimal=16)
        np.testing.assert_array_almost_equal(unwrap_single(np.stack(get_3d_coordinates(
            (5, 5, 5)), axis=-1), (5, 5, 5), 3), get_3d_coordinates_unwrapped((5, 5, 5), np.array([[1, 0.5, 0], [0, sqrt(3)/2, 0], [0, 0, 1]])/5), decimal=15)

    def test_get_3d_coordinates_unwrapped(self):
        np.testing.assert_array_almost_equal(get_3d_coordinates_unwrapped((4, 4, 4), np.array([[1, 0.5, 0], [0, sqrt(3)/2, 0], [0, 0, 1]])), np.array([[[[0., 0., 0.],
                                                                                                                                                         [0., 0., 1.],
                                                                                                                                                         [0., 0., 2.],
                                                                                                                                                         [0., 0., 3.]],

                                                                                                                                                        [[0.5, 0.8660254, 0.],
                                                                                                                                                         [0.5, 0.8660254, 1.],
                                                                                                                                                         [0.5, 0.8660254, 2.],
                                                                                                                                                         [0.5, 0.8660254, 3.]],

                                                                                                                                                        [[1., 1.73205081, 0.],
                                                                                                                                                         [1., 1.73205081, 1.],
                                                                                                                                                         [1., 1.73205081, 2.],
                                                                                                                                                         [1., 1.73205081, 3.]],

                                                                                                                                                        [[1.5, 2.59807621, 0.],
                                                                                                                                                         [1.5, 2.59807621, 1.],
                                                                                                                                                         [1.5, 2.59807621, 2.],
                                                                                                                                                         [1.5, 2.59807621, 3.]]],


                                                                                                                                                       [[[1., 0., 0.],
                                                                                                                                                         [1., 0., 1.],
                                                                                                                                                         [1., 0., 2.],
                                                                                                                                                         [1., 0., 3.]],

                                                                                                                                                        [[1.5, 0.8660254, 0.],
                                                                                                                                                         [1.5, 0.8660254, 1.],
                                                                                                                                                         [1.5, 0.8660254, 2.],
                                                                                                                                                         [1.5, 0.8660254, 3.]],

                                                                                                                                                        [[2., 1.73205081, 0.],
                                                                                                                                                         [2., 1.73205081, 1.],
                                                                                                                                                         [2., 1.73205081, 2.],
                                                                                                                                                         [2., 1.73205081, 3.]],

                                                                                                                                                        [[2.5, 2.59807621, 0.],
                                                                                                                                                         [2.5, 2.59807621, 1.],
                                                                                                                                                         [2.5, 2.59807621, 2.],
                                                                                                                                                         [2.5, 2.59807621, 3.]]],


                                                                                                                                                       [[[2., 0., 0.],
                                                                                                                                                         [2., 0., 1.],
                                                                                                                                                         [2., 0., 2.],
                                                                                                                                                         [2., 0., 3.]],

                                                                                                                                                        [[2.5, 0.8660254, 0.],
                                                                                                                                                         [2.5, 0.8660254, 1.],
                                                                                                                                                         [2.5, 0.8660254, 2.],
                                                                                                                                                         [2.5, 0.8660254, 3.]],

                                                                                                                                                        [[3., 1.73205081, 0.],
                                                                                                                                                         [3., 1.73205081, 1.],
                                                                                                                                                         [3., 1.73205081, 2.],
                                                                                                                                                         [3., 1.73205081, 3.]],

                                                                                                                                                        [[3.5, 2.59807621, 0.],
                                                                                                                                                         [3.5, 2.59807621, 1.],
                                                                                                                                                         [3.5, 2.59807621, 2.],
                                                                                                                                                         [3.5, 2.59807621, 3.]]],


                                                                                                                                                       [[[3., 0., 0.],
                                                                                                                                                         [3., 0., 1.],
                                                                                                                                                         [3., 0., 2.],
                                                                                                                                                         [3., 0., 3.]],

                                                                                                                                                        [[3.5, 0.8660254, 0.],
                                                                                                                                                         [3.5, 0.8660254, 1.],
                                                                                                                                                         [3.5, 0.8660254, 2.],
                                                                                                                                                         [3.5, 0.8660254, 3.]],

                                                                                                                                                        [[4., 1.73205081, 0.],
                                                                                                                                                         [4., 1.73205081, 1.],
                                                                                                                                                         [4., 1.73205081, 2.],
                                                                                                                                                         [4., 1.73205081, 3.]],

                                                                                                                                                        [[4.5, 2.59807621, 0.],
                                                                                                                                                         [4.5, 2.59807621, 1.],
                                                                                                                                                         [4.5, 2.59807621, 2.],
                                                                                                                                                         [4.5, 2.59807621, 3.]]]]), decimal=8)
        np.testing.assert_array_almost_equal(get_3d_coordinates_unwrapped((5, 5, 5), np.array([[1, 0.5, 0], [0, sqrt(3)/2, 0], [0, 0, 1]])), np.array([[[[0., 0., 0.],
                                                                                                                                                         [0., 0., 1.],
                                                                                                                                                         [0., 0., 2.],
                                                                                                                                                         [0., 0., 3.],
                                                                                                                                                         [0., 0., 4.]],

                                                                                                                                                        [[0.5, 0.8660254, 0.],
                                                                                                                                                         [0.5, 0.8660254, 1.],
                                                                                                                                                         [0.5, 0.8660254, 2.],
                                                                                                                                                         [0.5, 0.8660254, 3.],
                                                                                                                                                         [0.5, 0.8660254, 4.]],

                                                                                                                                                        [[1., 1.73205081, 0.],
                                                                                                                                                         [1., 1.73205081, 1.],
                                                                                                                                                         [1., 1.73205081, 2.],
                                                                                                                                                         [1., 1.73205081, 3.],
                                                                                                                                                         [1., 1.73205081, 4.]],

                                                                                                                                                        [[1.5, 2.59807621, 0.],
                                                                                                                                                         [1.5, 2.59807621, 1.],
                                                                                                                                                         [1.5, 2.59807621, 2.],
                                                                                                                                                         [1.5, 2.59807621, 3.],
                                                                                                                                                         [1.5, 2.59807621, 4.]],

                                                                                                                                                        [[2., 3.46410162, 0.],
                                                                                                                                                         [2., 3.46410162, 1.],
                                                                                                                                                         [2., 3.46410162, 2.],
                                                                                                                                                         [2., 3.46410162, 3.],
                                                                                                                                                         [2., 3.46410162, 4.]]],


                                                                                                                                                       [[[1., 0., 0.],
                                                                                                                                                         [1., 0., 1.],
                                                                                                                                                         [1., 0., 2.],
                                                                                                                                                         [1., 0., 3.],
                                                                                                                                                         [1., 0., 4.]],

                                                                                                                                                        [[1.5, 0.8660254, 0.],
                                                                                                                                                         [1.5, 0.8660254, 1.],
                                                                                                                                                         [1.5, 0.8660254, 2.],
                                                                                                                                                         [1.5, 0.8660254, 3.],
                                                                                                                                                         [1.5, 0.8660254, 4.]],

                                                                                                                                                        [[2., 1.73205081, 0.],
                                                                                                                                                         [2., 1.73205081, 1.],
                                                                                                                                                         [2., 1.73205081, 2.],
                                                                                                                                                         [2., 1.73205081, 3.],
                                                                                                                                                         [2., 1.73205081, 4.]],

                                                                                                                                                        [[2.5, 2.59807621, 0.],
                                                                                                                                                         [2.5, 2.59807621, 1.],
                                                                                                                                                         [2.5, 2.59807621, 2.],
                                                                                                                                                         [2.5, 2.59807621, 3.],
                                                                                                                                                         [2.5, 2.59807621, 4.]],

                                                                                                                                                        [[3., 3.46410162, 0.],
                                                                                                                                                         [3., 3.46410162, 1.],
                                                                                                                                                         [3., 3.46410162, 2.],
                                                                                                                                                         [3., 3.46410162, 3.],
                                                                                                                                                         [3., 3.46410162, 4.]]],


                                                                                                                                                       [[[2., 0., 0.],
                                                                                                                                                         [2., 0., 1.],
                                                                                                                                                         [2., 0., 2.],
                                                                                                                                                         [2., 0., 3.],
                                                                                                                                                         [2., 0., 4.]],

                                                                                                                                                        [[2.5, 0.8660254, 0.],
                                                                                                                                                         [2.5, 0.8660254, 1.],
                                                                                                                                                         [2.5, 0.8660254, 2.],
                                                                                                                                                         [2.5, 0.8660254, 3.],
                                                                                                                                                         [2.5, 0.8660254, 4.]],

                                                                                                                                                        [[3., 1.73205081, 0.],
                                                                                                                                                         [3., 1.73205081, 1.],
                                                                                                                                                         [3., 1.73205081, 2.],
                                                                                                                                                         [3., 1.73205081, 3.],
                                                                                                                                                         [3., 1.73205081, 4.]],

                                                                                                                                                        [[3.5, 2.59807621, 0.],
                                                                                                                                                         [3.5, 2.59807621, 1.],
                                                                                                                                                         [3.5, 2.59807621, 2.],
                                                                                                                                                         [3.5, 2.59807621, 3.],
                                                                                                                                                         [3.5, 2.59807621, 4.]],

                                                                                                                                                        [[4., 3.46410162, 0.],
                                                                                                                                                         [4., 3.46410162, 1.],
                                                                                                                                                         [4., 3.46410162, 2.],
                                                                                                                                                         [4., 3.46410162, 3.],
                                                                                                                                                         [4., 3.46410162, 4.]]],


                                                                                                                                                       [[[3., 0., 0.],
                                                                                                                                                         [3., 0., 1.],
                                                                                                                                                         [3., 0., 2.],
                                                                                                                                                         [3., 0., 3.],
                                                                                                                                                         [3., 0., 4.]],

                                                                                                                                                        [[3.5, 0.8660254, 0.],
                                                                                                                                                         [3.5, 0.8660254, 1.],
                                                                                                                                                         [3.5, 0.8660254, 2.],
                                                                                                                                                         [3.5, 0.8660254, 3.],
                                                                                                                                                         [3.5, 0.8660254, 4.]],

                                                                                                                                                        [[4., 1.73205081, 0.],
                                                                                                                                                         [4., 1.73205081, 1.],
                                                                                                                                                         [4., 1.73205081, 2.],
                                                                                                                                                         [4., 1.73205081, 3.],
                                                                                                                                                         [4., 1.73205081, 4.]],

                                                                                                                                                        [[4.5, 2.59807621, 0.],
                                                                                                                                                         [4.5, 2.59807621, 1.],
                                                                                                                                                         [4.5, 2.59807621, 2.],
                                                                                                                                                         [4.5, 2.59807621, 3.],
                                                                                                                                                         [4.5, 2.59807621, 4.]],

                                                                                                                                                        [[5., 3.46410162, 0.],
                                                                                                                                                         [5., 3.46410162, 1.],
                                                                                                                                                         [5., 3.46410162, 2.],
                                                                                                                                                         [5., 3.46410162, 3.],
                                                                                                                                                         [5., 3.46410162, 4.]]],


                                                                                                                                                       [[[4., 0., 0.],
                                                                                                                                                         [4., 0., 1.],
                                                                                                                                                         [4., 0., 2.],
                                                                                                                                                         [4., 0., 3.],
                                                                                                                                                         [4., 0., 4.]],

                                                                                                                                                        [[4.5, 0.8660254, 0.],
                                                                                                                                                         [4.5, 0.8660254, 1.],
                                                                                                                                                         [4.5, 0.8660254, 2.],
                                                                                                                                                         [4.5, 0.8660254, 3.],
                                                                                                                                                         [4.5, 0.8660254, 4.]],

                                                                                                                                                        [[5., 1.73205081, 0.],
                                                                                                                                                         [5., 1.73205081, 1.],
                                                                                                                                                         [5., 1.73205081, 2.],
                                                                                                                                                         [5., 1.73205081, 3.],
                                                                                                                                                         [5., 1.73205081, 4.]],

                                                                                                                                                        [[5.5, 2.59807621, 0.],
                                                                                                                                                         [5.5, 2.59807621, 1.],
                                                                                                                                                         [5.5, 2.59807621, 2.],
                                                                                                                                                         [5.5, 2.59807621, 3.],
                                                                                                                                                         [5.5, 2.59807621, 4.]],

                                                                                                                                                        [[6., 3.46410162, 0.],
                                                                                                                                                         [6., 3.46410162, 1.],
                                                                                                                                                         [6., 3.46410162, 2.],
                                                                                                                                                         [6., 3.46410162, 3.],
                                                                                                                                                         [6., 3.46410162, 4.]]]]), decimal=8)

    # def test_get_grid_xdim(self):
    #     u, v, w = get_grid((5, 1, 1))
    #     u_expected = np.array([[[-0.8]],
    #                            [[-0.4]],
    #                            [[0.]],
    #                            [[0.4]],
    #                            [[0.8]]])
    #     v_expected = np.array([[[0.]],
    #                            [[0.]],
    #                            [[0.]],
    #                            [[0.]],
    #                            [[0.]]])
    #     w_expected = np.array([[[0.]],
    #                            [[0.]],
    #                            [[0.]],
    #                            [[0.]],
    #                            [[0.]]])
    #     np.testing.assert_allclose(u, u_expected)
    #     np.testing.assert_allclose(v, v_expected)
    #     np.testing.assert_allclose(w, w_expected)

    # def test_get_grid_ydim(self):
    #     u, v, w = get_grid((1, 5, 1))
    #     u_expected = np.array([[[0.],
    #                            [0.],
    #                            [0.],
    #                            [0.],
    #                            [0.]]])
    #     v_expected = np.array([[[-0.8],
    #                            [-0.4],
    #                            [0.],
    #                            [0.4],
    #                            [0.8]]])
    #     w_expected = np.array([[[0.],
    #                            [0.],
    #                            [0.],
    #                            [0.],
    #                            [0.]]])
    #     np.testing.assert_allclose(u, u_expected)
    #     np.testing.assert_allclose(v, v_expected)
    #     np.testing.assert_allclose(w, w_expected)

    # def test_get_grid_zdim(self):
    #     u, v, w = get_grid((1, 1, 5))
    #     u_expected = np.array([[[0., 0., 0., 0., 0.]]])
    #     v_expected = np.array([[[0., 0., 0., 0., 0.]]])
    #     w_expected = np.array([[[-0.8, -0.4,  0.,
    #                              0.4000000000000001,  0.8]]])
    #     np.testing.assert_allclose(u, u_expected)
    #     np.testing.assert_allclose(v, v_expected)
    #     np.testing.assert_allclose(w, w_expected)

    # def test_get_grid(self):
    #     u, v, w = get_grid((5, 5, 5))
    #     u_expected = np.array([[[-0.8, -0.8, -0.8, -0.8, -0.8],
    #                             [-0.8, -0.8, -0.8, -0.8, -0.8],
    #                             [-0.8, -0.8, -0.8, -0.8, -0.8],
    #                             [-0.8, -0.8, -0.8, -0.8, -0.8],
    #                             [-0.8, -0.8, -0.8, -0.8, -0.8]],
    #                            [[-0.4, -0.4, -0.4, -0.4, -0.4],
    #                             [-0.4, -0.4, -0.4, -0.4, -0.4],
    #                             [-0.4, -0.4, -0.4, -0.4, -0.4],
    #                             [-0.4, -0.4, -0.4, -0.4, -0.4],
    #                             [-0.4, -0.4, -0.4, -0.4, -0.4]],
    #                            [[0.,  0.,  0.,  0.,  0.],
    #                             [0.,  0.,  0.,  0.,  0.],
    #                             [0.,  0.,  0.,  0.,  0.],
    #                             [0.,  0.,  0.,  0.,  0.],
    #                             [0.,  0.,  0.,  0.,  0.]],
    #                            [[0.4,  0.4,  0.4,  0.4,  0.4],
    #                             [0.4,  0.4,  0.4,  0.4,  0.4],
    #                             [0.4,  0.4,  0.4,  0.4,  0.4],
    #                             [0.4,  0.4,  0.4,  0.4,  0.4],
    #                             [0.4,  0.4,  0.4,  0.4,  0.4]],
    #                            [[0.8,  0.8,  0.8,  0.8,  0.8],
    #                             [0.8,  0.8,  0.8,  0.8,  0.8],
    #                             [0.8,  0.8,  0.8,  0.8,  0.8],
    #                             [0.8,  0.8,  0.8,  0.8,  0.8],
    #                             [0.8,  0.8,  0.8,  0.8,  0.8]]])
    #     v_expected = np.array([[[-0.8, -0.8, -0.8, -0.8, -0.8],
    #                             [-0.4, -0.4, -0.4, -0.4, -0.4],
    #                             [0.,  0.,  0.,  0.,  0.],
    #                             [0.4,  0.4,  0.4,  0.4,  0.4],
    #                             [0.8,  0.8,  0.8,  0.8,  0.8]],
    #                            [[-0.8, -0.8, -0.8, -0.8, -0.8],
    #                             [-0.4, -0.4, -0.4, -0.4, -0.4],
    #                             [0.,  0.,  0.,  0.,  0.],
    #                             [0.4,  0.4,  0.4,  0.4,  0.4],
    #                             [0.8,  0.8,  0.8,  0.8,  0.8]],
    #                            [[-0.8, -0.8, -0.8, -0.8, -0.8],
    #                             [-0.4, -0.4, -0.4, -0.4, -0.4],
    #                             [0.,  0.,  0.,  0.,  0.],
    #                             [0.4,  0.4,  0.4,  0.4,  0.4],
    #                             [0.8,  0.8,  0.8,  0.8,  0.8]],
    #                            [[-0.8, -0.8, -0.8, -0.8, -0.8],
    #                             [-0.4, -0.4, -0.4, -0.4, -0.4],
    #                             [0.,  0.,  0.,  0.,  0.],
    #                             [0.4,  0.4,  0.4,  0.4,  0.4],
    #                             [0.8,  0.8,  0.8,  0.8,  0.8]],
    #                            [[-0.8, -0.8, -0.8, -0.8, -0.8],
    #                             [-0.4, -0.4, -0.4, -0.4, -0.4],
    #                             [0.,  0.,  0.,  0.,  0.],
    #                             [0.4,  0.4,  0.4,  0.4,  0.4],
    #                             [0.8,  0.8,  0.8,  0.8,  0.8]]])
    #     w_expected = np.array([[[-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8]],
    #                            [[-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8]],
    #                            [[-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8]],
    #                            [[-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8]],
    #                            [[-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8],
    #                             [-0.8, -0.4,  0.,  0.4,  0.8]]])
    #     np.testing.assert_allclose(u, u_expected)
    #     np.testing.assert_allclose(v, v_expected)
    #     np.testing.assert_allclose(w, w_expected)


if __name__ == '__main__':
    unittest.main()
